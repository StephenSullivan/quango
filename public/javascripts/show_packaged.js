$(document).ready(function(){$("textarea").focus(function(){if(!window.onbeforeunload){window.onbeforeunload=function(){var filled=false;$('textarea').each(function(){if($.trim($(this).val())!=''){filled=true;}})
if(filled){return I18n.on_leave_page;}
return null;}}});})
(function($){$.fn.autoVideo=function(){this.each(function(){var isInCode=$(this).parents('code').length
if(!isInCode){var url=new String($(this).attr('href'));var video=false;var playButton='<img src="/images/play_button.png" class="play_button">';if(video=url.match(/http:\/\/www\.dailymotion\.com.*\/video\/(.+)_*/)){var thumb=$('<div class="thumb"><img src="http://www.dailymotion.com/thumbnail/160x120/video/'+video[1]+'" class="video_thumbnail"></div>').attr({"data-video-provider":"dailymotion","data-videoid":video[1]}).append(playButton);$(this).after(thumb)
thumb.one("click",function(){showPlayer(thumb)});$(this).remove();}else if(video=url.match(/http:\/\/(www.)?youtube\.com\/watch\?v=([A-Za-z0-9._%-]*)(\&\S+)?/)){var thumb=$('<div class="thumb"><img src="http://i.ytimg.com/vi/'+video[2]+'/1.jpg" class="video_thumbnail"></div>').attr({"data-video-provider":"youtube","data-videoid":video[2]}).append(playButton);$(this).after(thumb)
thumb.one("click",function(){showPlayer(thumb)});$(this).remove();}else if(video=url.match(/^(https?:\/\/[^\/]*metacafe.com\/)watch\/([\w-]+)\/([^\/]*)/i)){var thumb=$('<div class="thumb"><img src="http://www.metacafe.com/thumb/'+video[2]+'.jpg" class="video_thumbnail"></div>').attr({"data-video-provider":"metacafe","data-videoid":video[2]+'/'+video[3]}).append(playButton);$(this).after(thumb)
thumb.one("click",function(){showPlayer(thumb)});$(this).remove();}else if(video=url.match(/http:\/\/(www.)?vimeo\.com\/([A-Za-z0-9._%-]*)((\?|#)\S+)?/)){var thisurl=this;$.getJSON('http://vimeo.com/api/oembed.json?url=http%3A//vimeo.com/'+video[2]+'&callback=?',function(data){var thumb=$('<div class="thumb"><img src="'+data.thumbnail_url+'" class="video_thumbnail"></div>').attr({"data-video-provider":"vimeo","data-videoid":video[2],"data-html":data.html}).append(playButton);$(thisurl).after(thumb);thumb.one("click",function(){showPlayer(thumb)});$(thisurl).remove();})}else if(video=url.match(/^(https?:\/\/[^\/]*blip.tv\/)file\/([\w-]+).*/i)){var thisurl=this;$.getJSON('http://blip.tv/file?id='+video[2]+'&skin=json&version=2&callback=?',function(data){var thumb=$('<div class="thumb"><img src="'+data[0].thumbnailUrl+'" class="video_thumbnail"></div>').attr({"data-video-provider":"bliptv","data-videoid":video[2],"data-html":data[0].embedCode}).append(playButton);$(thisurl).after(thumb);thumb.one("click",function(){showPlayer(thumb)});$(thisurl).remove();})}else if(video=url.match(/\w+(\w+\.flv)/)){var thisurl=this;var thumb=$('<div class="thumb"><img src="/images/video.png" class="video_thumbnail"></div>').attr({"data-video-provider":"flv","data-videoid":url}).append(playButton);$(thisurl).after(thumb);thumb.one("click",function(){showPlayer(thumb)});$(thisurl).remove();}}})
function showPlayer(thumb){var videoid=thumb.attr('data-videoid');var provider=thumb.attr('data-video-provider');switch(provider){case"metacafe":thumb.html('<embed src="http://www.metacafe.com/fplayer/'+videoid+'.swf" width="400" height="345" wmode="transparent" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" allowFullScreen="true" allowScriptAccess="always" name="Metacafe_3930172"> </embed><br><font size = 1><a href="http://www.metacafe.com/watch/'+videoid+'/">Link to video</a> - <a href="http://www.metacafe.com/">The most popular videos are a click away</a></font>');break;case"youtube":thumb.html('<object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/'+videoid+'&hl=en_US&fs=1"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/'+videoid+'&hl=en_US&fs=1&" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="344"></embed></object>');break;case"dailymotion":videoid=videoid.split('_')[0]
thumb.html('<object width="480" height="365"><param name="movie" value="http://www.dailymotion.com/swf/x7rduv&related=0"></param><param name="allowFullScreen" value="true"></param><param name="allowScriptAccess" value="always"></param><embed src="http://www.dailymotion.com/swf/x7rduv&related=0" type="application/x-shockwave-flash" width="480" height="365" allowfullscreen="true" allowscriptaccess="always"></embed></object>');break;case"vimeo":thumb.html(thumb.attr('data-html'));break;case"bliptv":thumb.html(thumb.attr('data-html'));break;case"flv":thumb.html('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="640" height="375" id="FlvPlayer" align="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /><param name="movie" value="http://flvplayer.com/free-flv-player/FlvPlayer.swf" /><param name="quality" value="high" /><param name="bgcolor" value="FFFFFF" /><param name="FlashVars" value="flvpFolderLocation=http://flvplayer.com/free-flv-player/flvplayer/&flvpVideoSource='+thumb.attr("data-videoid")+'&flvpWidth=640&flvpHeight=375&flvpInitVolume=50&flvpTurnOnCorners=true&flvpBgColor=FFFFFF"><embed src="http://flvplayer.com/free-flv-player/FlvPlayer.swf" flashvars="flvpFolderLocation=http://flvplayer.com/free-flv-player/flvplayer/&flvpVideoSource='+thumb.attr("data-videoid")+'&flvpWidth=640&flvpHeight=375&flvpInitVolume=50&flvpTurnOnCorners=true&flvpBgColor=FFFFFF" quality="high" bgcolor="FFFFFF" width="640" height="375" name="FlvPlayer" align="middle" allowScriptAccess="sameDomain" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="http://www.adobe.com/go/getflashplayer" /></object>');break;}}}})(jQuery);$(document).ready(function(){$('.auto-link').autoVideo();$("form.vote_form button").live("click",function(event){var btn_name=$(this).attr("name");var form=$(this).parents("form");$.post(form.attr("action")+'.js',form.serialize()+"&"+btn_name+"=1",function(data){if(data.success){form.find(".votes_average").text(data.average)
if(data.vote_state=="deleted"){form.find("button[name=vote_down] img").attr("src","/images/to_vote_down.png")
form.find("button[name=vote_up] img").attr("src","/images/to_vote_up.png")}
else{if(data.vote_type=="vote_down"){form.find("button[name=vote_down] img").attr("src","/images/vote_down.png")
form.find("button[name=vote_up] img").attr("src","/images/to_vote_up.png")}else{form.find("button[name=vote_up] img").attr("src","/images/vote_up.png")
form.find("button[name=vote_down] img").attr("src","/images/to_vote_down.png")}}
showMessage(data.message,"notice")}else{showMessage(data.message,"error")
if(data.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}},"json");return false;});$(".comment .comment-votes form.vote-up-comment-form input[name=vote_up]").live("click",function(event){var btn=$(this)
var form=$(this).parents("form");btn.hide();$.post(form.attr("action"),form.serialize()+"&"+btn.attr("name")+"=1",function(data){if(data.success){if(data.vote_state=="deleted"){btn.attr("src","/images/dialog-ok.png")}else{btn.attr("src","/images/dialog-ok-apply.png")}
btn.parents(".comment-votes").children(".votes_average").html(data.average);showMessage(data.message,"notice")}else{showMessage(data.message,"error")}
btn.show();},"json");return false;});$("form.mainAnswerForm .button").live("click",function(event){var form=$(this).parents("form");var answers=$("#answers .block");var button=$(this)
button.attr('disabled',true)
$.ajax({url:form.attr("action"),data:form.serialize()+"&format=js",dataType:"json",type:"POST",success:function(data,textStatus,XMLHttpRequest){if(data.success){window.onbeforeunload=null;var answer=$(data.html)
answer.find("form.commentForm").hide();answers.append(answer)
highlightEffect(answer)
showMessage(data.message,"notice")
form.find("textarea").val("");form.find("#markdown_preview").html("");if($("#wysiwyg_editor").length>0)
$("#wysiwyg_editor").htmlarea('updateHtmlArea');removeFromLocalStorage(location.href,"markdown_editor");}else{showMessage(data.message,"error")
if(data.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}},error:manageAjaxError,complete:function(XMLHttpRequest,textStatus){button.attr('disabled',false)}});return false;});$("form.commentForm .button").live("click",function(event){var form=$(this).parents("form");var commentable=$(this).parents(".commentable");var comments=commentable.find(".comments")
var button=$(this)
button.attr('disabled',true)
$.ajax({url:form.attr("action"),data:form.serialize()+"&format=js",dataType:"json",type:"POST",success:function(data,textStatus,XMLHttpRequest){if(data.success){var textarea=form.find("textarea");window.onbeforeunload=null;var comment=$(data.html)
comments.append(comment)
highlightEffect(comment)
showMessage(data.message,"notice")
form.hide();textarea.val("");removeFromLocalStorage(location.href,textarea.attr('id'));}else{showMessage(data.message,"error")
if(data.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}},error:manageAjaxError,complete:function(XMLHttpRequest,textStatus){button.attr('disabled',false)}});return false;});$("#request_close_question_form").submit(function(){var request_button=$(this).find("input.button")
request_button.attr('disabled',true)
var close_button=$(this).find("button")
close_button.attr('disabled',true)
form=$(this)
$.ajax({url:$(this).attr("action"),data:$(this).serialize()+"&format=js",dataType:"json",type:"POST",success:function(data,textStatus,XMLHttpRequest){if(data.success){form.slideUp()
showMessage(data.message,"notice")}else{showMessage(data.message,"error")
if(data.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}},error:manageAjaxError,complete:function(XMLHttpRequest,textStatus){request_button.attr('disabled',false)
close_button.attr('disabled',false)}});return false;});$(".edit_comment").live("click",function(){var comment=$(this).parents(".comment")
var link=$(this)
link.hide()
$.ajax({url:$(this).attr("href"),dataType:"json",type:"GET",data:{format:'js'},success:function(data){comment=comment.append(data.html);link.hide()
var form=comment.find("form.form")
form.find(".cancel_edit_comment").click(function(){form.remove();link.show();return false;});var button=form.find("input[type=submit]");var textarea=form.find('textarea');form.submit(function(){button.attr('disabled',true)
$.ajax({url:form.attr("action"),dataType:"json",type:"PUT",data:form.serialize()+"&format=js",success:function(data,textStatus){if(data.success){comment.find(".markdown").html('<p>'+data.body+'</p>');form.remove();link.show();highlightEffect(comment);showMessage(data.message,"notice");removeFromLocalStorage(location.href,textarea.attr('id'));window.onbeforeunload=null;}else{showMessage(data.message,"error")
if(data.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}},error:manageAjaxError,complete:function(XMLHttpRequest,textStatus){button.attr('disabled',false)}});return false});},error:manageAjaxError,complete:function(XMLHttpRequest,textStatus){link.show()}});return false;});$(".addNestedAnswer").live("click",function(){var link=$(this);var user=link.attr('data-author');var isreply=link.hasClass('reply');var controls=link.parents(".body-col");var form=controls.parents(".answer").find("form.nestedAnswerForm");if(form.length==0)
form=link.parents("#question-body-col").find("form.commentForm");var textarea=form.find('textarea');var isHidden=!form.is(':visible');controls.find(".forms form.flag_form").slideUp();form.slideDown();if(isreply){textarea.focus();textarea.text('@'+user+' ')}else{textarea.text('').focus();}
var viewportHeight=window.innerHeight?window.innerHeight:$(window).height();var top=form.offset().top-viewportHeight/2;$('html,body').animate({scrollTop:top},1000);return false;});$("#add_comment_link").live('click',function(){var link=$(this);var isreply=link.hasClass('reply');var form=$("#add_comment_form");var textarea=form.find('textarea');$("#request_close_question_form").slideUp();$("#question_flag_form").slideUp();$("#close_question_form").slideUp();$("#add_comment_form").slideDown();textarea.text('').focus();var viewportHeight=window.innerHeight?window.innerHeight:$(window).height();var top=form.offset().top-viewportHeight/2;$('html,body').animate({scrollTop:top},1000);return false;});$('.cancel_comment').live('click',function(){$(this).parents('form').slideUp();return false;});$(".flag_form .cancel").live("click",function(){$(this).parents(".flag_form").slideUp();return false;});$(".close_form .cancel").live("click",function(){$(this).parents(".close_form").slideUp();return false;});$(".answer .flag-link").live("click",function(){var link=$(this);var href=link.attr('href');var controls=link.parents(".controls");if(!link.hasClass('busy')){link.addClass('busy');$.getJSON(href+'.js',function(data){controls.parents(".answer").find(".forms:first").html(data.html);link.removeClass('busy');})}
return false;});$("#close_question_link").click(function(){$("#add_comment_form").slideUp();var link=$(this);var href=link.attr('href');if(!link.hasClass('busy')){link.addClass('busy');$.getJSON(href+'.js',function(data){var controls=link.parents('.controls');controls.find(".forms").html(data.html);link.removeClass('busy');})}
return false;});$("#question_flag_link.flag-link, #edit_question_flag_link.flag-link").click(function(){$("#add_comment_form").slideUp();var link=$(this);var href=link.attr('href');if(!link.hasClass('busy')){link.addClass('busy');$.getJSON(href+'.js',function(data){var controls=link.parents('.controls');controls.find(".forms").html(data.html);link.removeClass('busy');})}
return false;});$("#request-close-link").click(function(){$("#add_comment_form").slideUp();var link=$(this);var href=link.attr('href');if(!link.hasClass('busy')){link.addClass('busy');$.getJSON(href+'.js',function(data){var controls=link.parents('.controls');controls.find(".forms").html(data.html);link.removeClass('busy');})}
return false;});$(".question-action").live("click",function(event){var link=$(this);if(!link.hasClass('busy')){link.addClass('busy');var href=link.attr("href");var dataUndo=link.attr("data-undo");var title=link.attr("title");var dataTitle=link.attr("data-title");var img=link.children('img');var counter=$(link.attr('data-counter'));$.getJSON(href+'.js',function(data){if(data.success){link.attr({href:dataUndo,'data-undo':href,title:dataTitle,'data-title':title});img.attr({src:img.attr('data-src'),'data-src':img.attr('src')});if(typeof(data.increment)!='undefined'){counter.text(parseFloat($.trim(counter.text()))+data.increment);}
showMessage(data.message,"notice");}else{showMessage(data.message,"error");if(data.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login";}}
link.removeClass('busy');},"json");}
return false;});});$(window).load(function(){prettyPrint();});