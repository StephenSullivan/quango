- show_close_request_form = !@question.closed && logged_in? && @question.can_be_requested_to_close_by?(current_user)
- show_open_request_form = @question.closed && logged_in? && @question.can_be_requested_to_open_by?(current_user)

.controls
  .actions
    - if !@flag.new?
      .flagged
        = "#{t('.flagged_as')} #{t(@flag.reason, :scope=>'flags.form')}"
        = link_to t("scaffold.edit"), edit_question_flag_path(@question,@flag), :class => "flag-link", :id => "edit_question_flag_link", :rel => 'nofollow'
        = link_to t("scaffold.destroy"), question_flag_path(@question,@flag), :id => "destroy_question_flag_link", :rel => 'nofollow', :confirm => "are you sure?", :method => :delete
    - elsif logged_in? && current_user != @question.user
      = link_to t(".flag"), new_question_flag_path(@question), :class => "flag-link", :id => "question_flag_link", :rel => 'nofollow'

    - if logged_in?
      - if show_close_request_form
        -if !@close_request.new?
          .flagged
            = "#{t('.requested_close_as')} #{t(@close_request.reason, :scope=>'close_requests.form')}"
            = link_to t(".edit_request"), edit_question_close_request_path(@question,@close_request), :class => "flag-link", :id => "edit_question_close_request_link", :rel => 'nofollow'
            = link_to t(".retract_request"), question_close_request_path(@question,@close_request), :id => "destroy_question_close_request_link", :rel => 'nofollow', :confirm => "are you sure?", :method => :delete
        = link_to t(".request_closing"), @close_request.new? ? new_question_close_request_path(@question) : edit_question_close_request_path(@question, @close_request), :id => "request-close-link", :rel => 'nofollow', :title => t('.request_closing_details')

      - if show_open_request_form
        -if !@open_request.new?
          .flagged
            = "#{t('.requested_reopening')} #{@open_request.comment}"
            = link_to t(".edit_request"), edit_question_open_request_path(@question, @open_request), :class => "flag-link", :id => "edit_question_open_request_link", :rel => 'nofollow'
            = link_to t(".retract_request"), question_open_request_path(@question,@open_request), :id => "destroy_question_open_request_link", :rel => 'nofollow', :confirm => "are you sure?", :method => :delete

        -if current_user.mod_of?(current_group)
          = link_to t(".open"), open_question_path(@question), :rel => 'nofollow', :title => t('.request_opening_details'), :method => "put"
        -else
          = link_to t(".request_opening"), new_question_open_request_path(@question), :id => "request-open-link", :rel => 'nofollow', :title => t('.request_opening_details')

      - if (@question.wiki && current_user.can_edit_wiki_post_on?(@question.group)) || current_user.can_edit_others_posts_on?(@question.group) || current_user.can_modify?(@question)
        = link_to t('scaffold.edit'), edit_question_path(@question), :class => "button"
      - if @question.versions.count > 0
        = link_to t(".history", :default => "history"), history_question_path(@question)
      - if (current_user.can_modify?(@question) || current_user.owner_of?(@question.group))
        = link_to t("scaffold.destroy"), question_path(@question.id), :confirm => "are you sure?", :method => :delete
      - if current_user.mod_of?(@question.group)
        -if !@question.closed
          = link_to t('.close'), question_close_requests_path(@question)
        = link_to t(".ban"), ban_path(:question_ids => [@question.id]), :class => "button", :confirm => "are you sure?"
